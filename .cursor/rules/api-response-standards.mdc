---
description: Reguli stricte pentru standardizarea răspunsurilor API, utilizarea DTO-urilor de output fără proprietăți opționale și documentarea status codurilor în Swagger.
globs: src/**/*.controller.ts, src/**/dto/*.ts
alwaysApply: true
---

# Standarde pentru API Response & Serializare (Strict Mode)

Sunteți un expert backend. Respectați aceste reguli pentru a asigura răspunsuri API consistente, securizate și perfect documentate.

## 1. Structura și Serializarea Răspunsului
- **DTO de Output Obligatoriu:** Nu returnați niciodată entitățile brute din baza de date (ex. Prisma). Creați întotdeauna un DTO de răspuns (ex: `UserResponseDto`).
- **Strict Non-Optional (Regulă Nouă):** În DTO-urile de răspuns, proprietățile **nu trebuie să fie opționale**. Este interzisă folosirea simbolului `?`. Dacă un câmp poate fi nul, acesta trebuie definit explicit ca `string | null`, dar trebuie să fie prezent în obiectul JSON returnat.
- **Transformare:** Folosiți `@Expose()` și `@Exclude()` din `class-transformer` pentru a filtra datele sensibile (ex: parole, hash-uri).
- **Format Unitat:** Toate endpoint-urile care returnează liste trebuie să fie înfășurate în structura: `{ "data": T[], "meta": { "totalItems": number, "currentPage": number, "itemsPerPage": number, "totalPages": number } }`.
- **Date Calendaristice:** Toate datele trebuie returnate ca string în format ISO 8601.

## 2. Decoratori Swagger (Obligatorii)
Fiecare metodă din Controller trebuie să specifice explicit tipul de returnare:
- **Succes (Regulă Strictă):** Este INTERZISĂ returnarea unui DTO direct fără wrapper-ul `data`.
  ```typescript
  @ApiResponse({ 
    status: 200,
    schema: { 
      type: 'object',
      required: ['data'],
      properties: { 
        data: { $ref: getSchemaPath(NumeResponseDto) } 
      } 
    } 
  })
  ```
- **Documentare Erori:** Documentați obligatoriu statusurile 400, 401 (dacă există Guard) și 404 folosind `ErrorResponseDto`.

## 3. Validare și Tipizare
- **Class-Validator:** Toate DTO-urile de intrare (Request) trebuie să aibă decoratori de validare activi.
- **Proprietăți Grăitoare:** Folosiți `@ApiProperty()` pentru fiecare câmp din DTO-urile de răspuns. Specificați `example` și `required: true`.
- **Naming:** DTO-urile de răspuns se vor numi întotdeauna după șablonul `[Nume]ResponseDto.ts`.

## 4. Reguli de Implementare pentru AI
- **Fără Placeholders:** Generați clasa DTO completă. Toate câmpurile trebuie să fie definite clar.
- **Fără ?: (Optional Chaining):** În loc de `name?: string`, folosiți `name: string`. Dacă datele lipsesc, asigurați-vă că DTO-ul este populat cu o valoare default sau `null`.
- **Consistency:** Metoda de creare trebuie să returneze `201 Created`, nu `200 OK`.

## 5. Instrucțiuni de Context
- **Interceptoare:** Verificați dacă există un `TransformInterceptor` global. Chiar dacă acesta există, decoratorul `@ApiResponse` din Controller trebuie să reflecte structura finală (cu `data`) pentru a genera un client corect.
- **Sincronizare:** Asigurați-vă că tipurile de date din `ResponseDto` corespund exact cu tipurile returnate de serviciul care interoghează baza de date.