---
description: Reguli stricte pentru standardizarea răspunsurilor API, utilizarea DTO-urilor de output și documentarea status codurilor în Swagger.
globs: src/**/*.controller.ts, src/**/dto/*.ts
alwaysApply: true
---

# Standarde pentru API Response & Serializare

Sunteți un expert backend. Respectați aceste reguli pentru a asigura răspunsuri API consistente, securizate și perfect documentate pentru client.

## 1. Structura și Serializarea Răspunsului
- **DTO de Output obligatoriu:** Nu returnați niciodată entitățile brute din Prisma. Creați întotdeauna un DTO de răspuns (ex: `UserResponseDto`).
- **Transformare:** Folosiți `@Expose()` și `@Exclude()` din `class-transformer` în DTO-urile de răspuns pentru a filtra datele sensibile (ex: parole, hash-uri).
- **Format Unitat:** Toate endpoint-urile care returnează liste trebuie să fie înfășurate într-un obiect cu structura: `{ "data": [], "meta": { "total": number, "page": number } }`.
- **Date Calendaristice:** Toate datele trebuie returnate în format ISO 8601 string.

## 2. Decoratori Swagger (Obligatorii)
Fiecare metodă din Controller trebuie să specifice explicit tipul de returnare pentru generarea automată a clientului:
- **Succes (REGULĂ STRICTĂ):** Este INTERZISĂ returnarea unui DTO direct. Folosiți schema cu wrapper `data`:
  ```typescript
  @ApiResponse({ 
    status: 200/201, 
    schema: { 
      type: 'object',
      properties: { 
        data: { $ref: getSchemaPath(NumeResponseDto) } 
      } 
    } 
  })
  ```
  Dacă este listă, adăugați `isArray: true` în schema `data`.
- **Erori Comune:** Documentați întotdeauna cel puțin:
  - `@ApiResponse({ status: 400, description: 'Validare eșuată', type: ErrorResponseDto, schema: { $ref: getSchemaPath(ErrorResponseDto) }, example: {...} })`
  - `@ApiResponse({ status: 404, description: 'Resursa nu există', type: ErrorResponseDto, schema: { $ref: getSchemaPath(ErrorResponseDto) }, example: {...} })`
  - `@ApiResponse({ status: 401, description: 'Neautorizat', type: ErrorResponseDto, schema: { $ref: getSchemaPath(ErrorResponseDto) }, example: {...} })` (dacă există Guard).

## 3. Validare și Tipizare
- **Class-Validator:** Toate DTO-urile de intrare (Request) trebuie să aibă decoratori de validare activi.
- **Naming Convention:** DTO-urile de răspuns se vor numi întotdeauna după șablonul `[Nume]ResponseDto.ts`.

## 4. Reguli de Implementare pentru AI
- **Fără Placeholders:** Generați clasa DTO completă, cu toți decoratorii Swagger și de validare.
- **Strict Layout:** Plasați DTO-urile de răspuns în folderul `src/[module]/dto/`.
- **Consistency:** Dacă o metodă returnează un obiect creat nou, asigurați-vă că statusul este `201 Created`, nu `200 OK`.

## 5. Instrucțiuni de Context
- **Verificare Interceptoare:** Înainte de a genera un format nou, verificați dacă există deja un `TransformInterceptor` global care înfășoară răspunsurile.
- **Sincronizare:** Asigurați-vă că tipurile de date din `ResponseDto` corespund cu tipurile returnate de serviciul care apelează Prisma.
